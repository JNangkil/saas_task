<div class="password-change">
    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
        <!-- Current Password -->
        <div class="mb-3">
            <label for="current_password" class="form-label">Current Password</label>
            <div class="input-group">
                <input type="password" id="current_password" class="form-control" formControlName="current_password"
                    [type]="showCurrentPassword ? 'text' : 'password'" placeholder="Enter your current password">
                <button class="btn btn-outline-secondary" type="button" (click)="togglePasswordVisibility('current')"
                    tabindex="-1">
                    <i class="bi" [class.bi-eye]="!showCurrentPassword" [class.bi-eye-slash]="showCurrentPassword"></i>
                </button>
            </div>
            <div class="invalid-feedback" *ngIf="hasError('current_password')">
                {{ getErrorMessage('current_password') }}
            </div>
        </div>

        <!-- New Password -->
        <div class="mb-3">
            <label for="password" class="form-label">New Password</label>
            <div class="input-group">
                <input type="password" id="password" class="form-control" formControlName="password"
                    [type]="showNewPassword ? 'text' : 'password'" placeholder="Enter your new password">
                <button class="btn btn-outline-secondary" type="button" (click)="togglePasswordVisibility('new')"
                    tabindex="-1">
                    <i class="bi" [class.bi-eye]="!showNewPassword" [class.bi-eye-slash]="showNewPassword"></i>
                </button>
            </div>
            <div class="invalid-feedback" *ngIf="hasError('password')">
                {{ getErrorMessage('password') }}
            </div>

            <!-- Password Strength Indicator -->
            <div class="password-strength mt-2" *ngIf="passwordForm.get('password')?.value">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <small class="text-muted">Password Strength:</small>
                    <small class="fw-bold" [ngClass]="getPasswordStrength(passwordForm.get('password')?.value).color">
                        {{ getPasswordStrength(passwordForm.get('password')?.value).label }}
                    </small>
                </div>
                <div class="progress" style="height: 4px;">
                    <div class="progress-bar" role="progressbar" [ngClass]="{
                             'bg-danger': getPasswordStrength(passwordForm.get('password')?.value).strength <= 2,
                             'bg-warning': getPasswordStrength(passwordForm.get('password')?.value).strength === 3,
                             'bg-info': getPasswordStrength(passwordForm.get('password')?.value).strength === 4,
                             'bg-success': getPasswordStrength(passwordForm.get('password')?.value).strength >= 5
                         }"
                        [style.width.%]="(getPasswordStrength(passwordForm.get('password')?.value).strength / 5) * 100">
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Password -->
        <div class="mb-4">
            <label for="password_confirmation" class="form-label">Confirm New Password</label>
            <div class="input-group">
                <input type="password" id="password_confirmation" class="form-control"
                    formControlName="password_confirmation" [type]="showConfirmPassword ? 'text' : 'password'"
                    placeholder="Confirm your new password">
                <button class="btn btn-outline-secondary" type="button" (click)="togglePasswordVisibility('confirm')"
                    tabindex="-1">
                    <i class="bi" [class]="showConfirmPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
                </button>
            </div>
            <div class="invalid-feedback" *ngIf="hasError('password_confirmation')">
                {{ getErrorMessage('password_confirmation') }}
            </div>
        </div>

        <!-- Submit Button -->
        <div class="d-grid">
            <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || isSubmitting">
                <i class="bi bi-key me-2" *ngIf="!isSubmitting"></i>
                <span class="spinner-border spinner-border-sm me-2" *ngIf="isSubmitting"></span>
                {{ isSubmitting ? 'Changing Password...' : 'Change Password' }}
            </button>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements mt-3">
            <h6 class="text-muted">Password Requirements:</h6>
            <ul class="small text-muted">
                <li>At least 8 characters long</li>
                <li>Contains uppercase and lowercase letters</li>
                <li>Contains numbers</li>
                <li>Contains special characters (recommended)</li>
            </ul>
        </div>
    </form>
</div>