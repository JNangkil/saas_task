<div class="accept-invitation-container">
    <div class="invitation-card">
        <!-- Loading State -->
        <div *ngIf="currentView === 'loading'" class="loading-state">
            <div class="spinner"></div>
            <p>Checking invitation details...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="currentView === 'error'" class="error-state">
            <div class="error-icon">⚠️</div>
            <h2>Invalid Invitation</h2>
            <p>{{ errorMessage }}</p>
            <button class="btn btn-primary" routerLink="/workspaces">Go to Workspaces</button>
        </div>

        <!-- Invitation Details -->
        <div *ngIf="currentView === 'invitation' && invitation" class="invitation-details">
            <div class="invitation-header">
                <h2>You're Invited!</h2>
                <p>You've been invited to join a workspace</p>
            </div>

            <div class="invitation-info">
                <div class="workspace-info">
                    <h3>{{ invitation.workspace.name }}</h3>
                    <p *ngIf="invitation.workspace.description">{{ invitation.workspace.description }}</p>
                </div>

                <div class="invitation-meta">
                    <div class="meta-item">
                        <span class="meta-label">Invited by:</span>
                        <span class="meta-value">{{ invitation.invited_by_user.name }} ({{
                            invitation.invited_by_user.email }})</span>
                    </div>

                    <div class="meta-item">
                        <span class="meta-label">Role:</span>
                        <span class="meta-value">{{ getRoleDisplayText(invitation.invitation.role) }}</span>
                    </div>

                    <div class="meta-item">
                        <span class="meta-label">Email:</span>
                        <span class="meta-value">{{ invitation.invitation.email }}</span>
                    </div>
                </div>

                <div class="role-description">
                    <p>{{ getRoleDescription(invitation.invitation.role) }}</p>
                </div>
            </div>

            <div class="invitation-actions">
                <button class="btn btn-success" (click)="acceptInvitation()" [disabled]="isSubmitting">
                    {{ isSubmitting ? 'Accepting...' : 'Accept Invitation' }}
                </button>

                <button class="btn btn-outline-secondary" (click)="declineInvitation()" [disabled]="isSubmitting">
                    {{ isSubmitting ? 'Declining...' : 'Decline' }}
                </button>
            </div>
        </div>

        <!-- Login Form -->
        <div *ngIf="currentView === 'login'" class="auth-form">
            <div class="auth-header">
                <h2>Sign In to Accept Invitation</h2>
                <p>Please sign in to accept the invitation</p>
            </div>

            <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input id="login-email" type="email" class="form-control" formControlName="email"
                        [value]="invitation?.invitation?.email || ''" placeholder="Enter your email">
                    <div *ngIf="loginForm.get('email')?.touched && loginForm.get('email')?.invalid"
                        class="error-message">
                        {{ getLoginErrorMessage('email') }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input id="login-password" type="password" class="form-control" formControlName="password"
                        placeholder="Enter your password">
                    <div *ngIf="loginForm.get('password')?.touched && loginForm.get('password')?.invalid"
                        class="error-message">
                        {{ getLoginErrorMessage('password') }}
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block" [disabled]="loginForm.invalid || isSubmitting">
                    {{ isSubmitting ? 'Signing In...' : 'Sign In' }}
                </button>
            </form>

            <div class="auth-switch">
                <p>Don't have an account? <a href="#" (click)="switchToRegister()">Sign up</a></p>
            </div>
        </div>

        <!-- Registration Form -->
        <div *ngIf="currentView === 'register'" class="auth-form">
            <div class="auth-header">
                <h2>Create Account to Accept Invitation</h2>
                <p>Create a new account to join the workspace</p>
            </div>

            <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
                <div class="form-group">
                    <label for="register-name">Full Name</label>
                    <input id="register-name" type="text" class="form-control" formControlName="name"
                        placeholder="Enter your full name">
                    <div *ngIf="registerForm.get('name')?.touched && registerForm.get('name')?.invalid"
                        class="error-message">
                        {{ getRegisterErrorMessage('name') }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input id="register-email" type="email" class="form-control" formControlName="email"
                        [value]="invitation?.invitation?.email || ''" placeholder="Enter your email">
                    <div *ngIf="registerForm.get('email')?.touched && registerForm.get('email')?.invalid"
                        class="error-message">
                        {{ getRegisterErrorMessage('email') }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input id="register-password" type="password" class="form-control" formControlName="password"
                        placeholder="Create a password">
                    <div *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.invalid"
                        class="error-message">
                        {{ getRegisterErrorMessage('password') }}
                    </div>
                </div>

                <div class="form-group">
                    <label for="register-confirm-password">Confirm Password</label>
                    <input id="register-confirm-password" type="password" class="form-control"
                        formControlName="confirmPassword" placeholder="Confirm your password">
                    <div *ngIf="registerForm.get('confirmPassword')?.touched && (registerForm.get('confirmPassword')?.invalid || registerForm.errors?.['passwordMismatch'])"
                        class="error-message">
                        {{ getRegisterErrorMessage('confirmPassword') }}
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block"
                    [disabled]="registerForm.invalid || isSubmitting">
                    {{ isSubmitting ? 'Creating Account...' : 'Create Account' }}
                </button>
            </form>

            <div class="auth-switch">
                <p>Already have an account? <a href="#" (click)="switchToLogin()">Sign in</a></p>
            </div>
        </div>

        <!-- Success State -->
        <div *ngIf="currentView === 'success'" class="success-state">
            <div class="success-icon">✅</div>
            <h2>{{ successMessage }}</h2>
            <p>You will be redirected to the workspace in {{ redirectCountdown }} seconds</p>
            <button class="btn btn-primary" (click)="redirectToWorkspaceNow()">
                Go to Workspace Now
            </button>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage && currentView !== 'error'" class="alert alert-danger">
            {{ errorMessage }}
        </div>
    </div>
</div>