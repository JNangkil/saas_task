<tr class="task-row" [class.selected]="selected" (click)="onRowClick($event)" (dblclick)="onRowDoubleClick()">

    <!-- Selection Checkbox -->
    <td class="select-cell" *ngIf="showCheckbox">
        <input type="checkbox" [checked]="selected" (change)="onCheckboxChange($event)" class="task-checkbox"
            [disabled]="!selectable">
    </td>

    <!-- Task Title -->
    <td class="title-cell">
        <div class="task-content">
            <!-- Title Display -->
            <div class="task-title editable-field" *ngIf="!isEditing('title')" (click)="startEditing('title', $event)"
                title="Click to edit">
                {{ task.title }}
            </div>
            <!-- Title Edit -->
            <div class="task-title-edit" *ngIf="isEditing('title')">
                <input type="text" class="title-input" [ngModel]="editValue" (ngModelChange)="editValue = $event"
                    (keydown)="onEditKeydown($event)" (blur)="onEditBlur()" data-edit-field="title"
                    [disabled]="loading">
                <div class="edit-actions" *ngIf="loading || error">
                    <span class="loading-spinner" *ngIf="loading">‚è≥</span>
                    <span class="error-message" *ngIf="error">{{ error }}</span>
                </div>
            </div>
            <div class="task-description" *ngIf="task.description">
                {{ task.description }}
            </div>
        </div>
    </td>

    <!-- Status -->
    <td class="status-cell">
        <!-- Status Display -->
        <span class="status-badge editable-field" *ngIf="!isEditing('status')"
            [class]="getStatusBadgeClass(task.status)" (click)="startEditing('status', $event)" title="Click to edit">
            {{ formatStatus(task.status) }}
        </span>
        <!-- Status Edit -->
        <select class="status-select editable-field" *ngIf="isEditing('status')" [ngModel]="editValue"
            (ngModelChange)="editValue = $event" (keydown)="onEditKeydown($event)" (blur)="onEditBlur()"
            data-edit-field="status" [disabled]="loading">
            <option *ngFor="let option of statusOptions" [value]="option.value">
                {{ option.label }}
            </option>
        </select>
    </td>

    <!-- Priority -->
    <td class="priority-cell">
        <!-- Priority Display -->
        <span class="priority-badge editable-field" *ngIf="!isEditing('priority')"
            [class]="getPriorityBadgeClass(task.priority)" (click)="startEditing('priority', $event)"
            title="Click to edit">
            {{ formatPriority(task.priority) }}
        </span>
        <!-- Priority Edit -->
        <select class="priority-select editable-field" *ngIf="isEditing('priority')" [ngModel]="editValue"
            (ngModelChange)="editValue = $event" (keydown)="onEditKeydown($event)" (blur)="onEditBlur()"
            data-edit-field="priority" [disabled]="loading">
            <option *ngFor="let option of priorityOptions" [value]="option.value">
                {{ option.label }}
            </option>
        </select>
    </td>

    <!-- Assignee -->
    <td class="assignee-cell">
        <!-- Assignee Display -->
        <div class="assignee-info editable-field" *ngIf="!isEditing('assignee_id')"
            (click)="startEditing('assignee_id', $event)" title="Click to edit">
            <div class="assignee-info" *ngIf="task.assignee; else noAssignee">
                <div class="assignee-avatar" [style.background-color]="getAvatarColor(task.assignee.email)">
                    {{ getUserInitials(task.assignee) }}
                </div>
                <div class="assignee-details">
                    <div class="assignee-name">{{ task.assignee.name }}</div>
                    <div class="assignee-email">{{ task.assignee.email }}</div>
                </div>
            </div>
            <ng-template #noAssignee>
                <span class="no-assignee">Unassigned</span>
            </ng-template>
        </div>
        <!-- Assignee Edit -->
        <div class="assignee-edit" *ngIf="isEditing('assignee_id')">
            <select class="assignee-select editable-field" [ngModel]="editValue" (ngModelChange)="editValue = $event"
                (keydown)="onEditKeydown($event)" (blur)="onEditBlur()" data-edit-field="assignee_id"
                [disabled]="loading">
                <option [ngValue]="null">Unassigned</option>
                <!-- This would need to be populated with actual users from the workspace -->
                <option [ngValue]="1">User 1</option>
                <option [ngValue]="2">User 2</option>
                <!-- TODO: Replace with actual workspace users -->
            </select>
        </div>
    </td>

    <!-- Due Date -->
    <td class="due-date-cell">
        <!-- Due Date Display -->
        <span class="due-date editable-field" *ngIf="!isEditing('due_date')" [class.overdue]="isOverdue(task.due_date)"
            (click)="startEditing('due_date', $event)" title="Click to edit">
            <span *ngIf="task.due_date; else noDueDate">
                {{ formatDate(task.due_date) }}
            </span>
            <ng-template #noDueDate>
                <span class="no-due-date">No due date</span>
            </ng-template>
        </span>
        <!-- Due Date Edit -->
        <input type="date" class="due-date-input editable-field" *ngIf="isEditing('due_date')" [ngModel]="editValue"
            (ngModelChange)="editValue = $event" (keydown)="onEditKeydown($event)" (blur)="onEditBlur()"
            data-edit-field="due_date" [disabled]="loading">
    </td>

    <!-- Labels -->
    <td class="labels-cell">
        <div class="task-labels" *ngIf="getVisibleLabels().length > 0; else noLabels">
            <span class="task-label" *ngFor="let label of getVisibleLabels()"
                [style.background-color]="label.color + '20'" [style.color]="label.color" [title]="label.name">
                {{ label.name }}
            </span>
            <span class="more-labels" *ngIf="getHiddenLabelsCount() > 0"
                [title]="'+' + getHiddenLabelsCount() + ' more labels'">
                +{{ getHiddenLabelsCount() }}
            </span>
        </div>
        <ng-template #noLabels>
            <span class="no-labels">No labels</span>
        </ng-template>
    </td>
</tr>